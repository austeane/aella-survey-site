# Repomix Guide

How to generate AI-friendly repo snapshots for this project using [repomix](https://github.com/yamadashy/repomix).

## Quick Command

```bash
npx repomix --no-security-check -o repomix-output.xml \
  --ignore "data/**,Big Kink Survey*,src/lib/schema/columns.generated.json,public/**,**/*.test.ts,pnpm-lock.yaml,.husky/**,design-mockups/**,BKSPublic_column_notes.txt,BKSPublic.parquet,src/routeTree.gen.ts" \
  --style xml
```

This produces a ~44k token XML file containing all source code, docs, and config.

## Budget Breakdown

The full unfiltered repo is ~205k tokens. The target is **50k tokens or less** so the output fits in a single LLM context window alongside a meaningful prompt.

### Always exclude (not useful to LLMs, or binary/generated)

| Path | Tokens | Reason |
|------|--------|--------|
| `data/BKSPublic.parquet` | binary | Parquet file, not readable |
| `public/BKSPublic.parquet` | binary | Copy of above |
| `BKSPublic.parquet` | binary | Symlink/copy at root |
| `pnpm-lock.yaml` | ~15k | Lock file, no signal |
| `.husky/**` | ~200 | Git hook scripts, boilerplate |
| `src/routeTree.gen.ts` | ~1.9k | Auto-generated by TanStack Router |
| `src/lib/schema/columns.generated.json` | ~26k | Auto-generated, regenerate with `pnpm profile-schema` |

### Exclude by default (large, summarizable)

| Path | Tokens | Why exclude | Summary strategy |
|------|--------|-------------|------------------|
| `data/Big Kink Survey (970k cleaned).md` | ~45k | Single file = entire budget | Include `repomix-notes.md` which has a condensed summary |
| `data/BKSPublic_column_notes.txt` | ~1.3k | Raw notes, covered by schema metadata | Summarized in `docs/schema/data-exploration.md` |
| `design-mockups/` (4 HTML files) | ~21k | Historical design exploration | Note in `repomix-notes.md`: 4 mockups, ink-and-paper was chosen |
| `**/*.test.ts` (8 files) | ~7k | Tests are useful but expendable | Note in `repomix-notes.md`: 121 tests, list of coverage areas |

### Include conditionally (if budget allows)

| Path | Tokens | When to include |
|------|--------|-----------------|
| `mcp-server/` | ~5.8k | When the task involves MCP, Python, or deployment |
| `**/*.test.ts` | ~7k | When the task involves testing or refactoring |
| `design-mockups/01-ink-and-paper.html` | ~4.9k | When the task involves design system work |
| `src/routeTree.gen.ts` | ~1.9k | When the task involves routing |

## Preset Configurations

### Full app context (default, ~48k tokens)
All source, docs, config, MCP server. Excludes data files, generated JSON, tests, mockups.

```bash
npx repomix --no-security-check -o repomix-output.xml \
  --ignore "data/**,Big Kink Survey*,src/lib/schema/columns.generated.json,public/**,**/*.test.ts,pnpm-lock.yaml,.husky/**,design-mockups/**,BKSPublic_column_notes.txt,BKSPublic.parquet,src/routeTree.gen.ts" \
  --style xml
```

### Source only (~35k tokens)
Just the TypeScript/React source code + CLAUDE.md. For pure coding tasks.

```bash
npx repomix --no-security-check -o repomix-output.xml \
  --ignore "data/**,Big Kink Survey*,src/lib/schema/columns.generated.json,public/**,**/*.test.ts,pnpm-lock.yaml,.husky/**,design-mockups/**,BKSPublic_column_notes.txt,BKSPublic.parquet,src/routeTree.gen.ts,mcp-server/**,docs/**,META-PLAN.md,PLAN.md,scripts/**" \
  --style xml
```

### Docs + architecture only (~20k tokens)
For planning, design review, or onboarding a new agent. No source code.

```bash
npx repomix --no-security-check -o repomix-output.xml \
  --ignore "data/**,Big Kink Survey*,src/**,public/**,pnpm-lock.yaml,.husky/**,design-mockups/**,BKSPublic_column_notes.txt,BKSPublic.parquet,mcp-server/**,scripts/**" \
  --style xml
```

## The `repomix-notes.md` File

This file lives at the repo root and summarizes everything that gets excluded from the default repomix output. It's included in the repomix output automatically and gives the LLM awareness of what exists but isn't shown. Keep it updated when major excluded content changes.

Contents:
- **design-mockups/**: What each mockup explored, which was chosen
- **mcp-server/**: Tools, transport, safety model, deployment URL
- **test files**: Test count, coverage areas, frameworks
- **columns.generated.json**: Schema shape and how to regenerate
- **Big Kink Survey doc**: Condensed survey structure, gating logic, derived variables, data quality caveats

## Maintenance

When the repo changes significantly:
1. Regenerate the default output and check token count stays under 50k
2. Update `repomix-notes.md` if excluded content has changed materially
3. If a new large file is added (>2k tokens), decide whether to exclude it and add to the ignore list above
